<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Air quality data from archive.luftdaten.info</title>
        <link rel="stylesheet" href="style.css" type="text/css">
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		
        <script src="./lib/amcharts/amcharts.js" type="text/javascript"></script>
        <script src="./lib/amcharts/serial.js" type="text/javascript"></script>
		<script src="./lib/amcharts/amstock.js" type="text/javascript"></script>
		<script src="./lib/amcharts/plugins/dataloader/dataloader.min.js" type="text/javascript"></script>
		
		<script src="https://momentjs.com/downloads/moment.js"></script>
		<script src="./script/rsvp.js"></script>

		<script>

    $(document).ready(function(){
        $("button").click(function(){
		
            //http://api.luftdaten.info/static/v1/data/data.json.2017-06-03-02-00
		    
			var result = "";
			var times = [];
			for(h=0; h<=23; h++)
			{
			    var hour = h;
				if (hour <=9) hour = "0" + hour;
				
				for(m=0; m<=55; m=m+5)
				{
				   var minute = m;
				   if (minute <=9) minute = "0" + minute;
				   
				    times.push(hour + "-" + minute); 
					//console.log(hour + "-" + minute);
				}
			}
			
			console.log("Files: " + times.length);
			
			var promises = times.map(function(id){
			  var file = "http://api.luftdaten.info/static/v1/data/data.json.2017-06-01-" + id;
			  console.log(file);
			  return jQuery.getJSON(file);
			});

			RSVP.all(promises).then(function(posts) {
			  // posts contains an array of results for the given promises
			  for(i=0; i< posts.length; i++)
			  {
			       result += posts[i];
			  }
			  console.log("done processing");
			  
			}).catch(function(reason){
			  console.log("Promise json get data error: " + reason);
			});
			
	   }); //button click
	}); //ready			
			
			
			function getRemote(remote_url) {
				return $.ajax({
					type: "GET",
					url: remote_url,
					async: false //on purpose, because we can not continue until all files are downloaded
				}).responseText;
			}

        </script>
    </head>

    <body>
	    <table style="width: 100%;">
		  <tr align="left">
		      <td>SDS011 sensor map ID: <input name="sensorTxt" type="text" maxlength="8" id="sensorTxt" value="227" /></td>
			  <td>Sensor time zone: +<input name="sensorTimeZone" type="text" maxlength="8" id="sensorTimeZone" value="0" /></td>
			  <td>For the last: <input name="daysBeforeTxt" type="text" maxlength="8" id="daysBeforeTxt" value="3"/> days</td>
			  <td> PM 10 <input type="radio" name="group1" id="radioPM10" value="pm10">
				   PM 2.5 <input type="radio" name="group1" id="radioPM25" value="pm25" checked="checked">
			  </td> 
			  <td><button type="button">Process</button></td>
		  </tr>
		  <tr>
			  <td colspan="5">
			     <div id="chartdiv" style="width: 100%; height: 450px;"></div>
			  </td>
		  <tr>
    </body>

</html>